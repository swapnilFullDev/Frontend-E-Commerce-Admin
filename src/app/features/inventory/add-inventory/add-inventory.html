<!-- src/app/components/inventory-dialog/inventory-dialog.component.html -->
<h2 mat-dialog-title>{{ isEdit ? 'Edit Inventory Item' : 'Add Inventory Item' }}</h2>

<form [formGroup]="inventoryForm" mat-dialog-content>
  <mat-horizontal-stepper [linear]="false" #stepper>
    <!-- Step 1: Basic -->
    <mat-step [stepControl]="basicInfo">
      <form [formGroup]="basicInfo">
        <ng-template matStepLabel>Basic Info</ng-template>

        <mat-form-field appearance="fill" class="w-full mb-3">
          <mat-label>Product Name</mat-label>
          <input matInput formControlName="productName" required maxlength="255" />
          <mat-error *ngIf="inventoryForm.get('basicInfo.productName')?.hasError('required')">Required</mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill" class="w-full mb-3">
          <mat-label>Available Colour</mat-label>
          <input matInput formControlName="availableColour" maxlength="100" />
        </mat-form-field>

        <mat-form-field appearance="fill" class="w-full mb-3">
          <mat-label>Price</mat-label>
          <input matInput type="number" formControlName="prices" required min="0" />
        </mat-form-field>

        <mat-checkbox formControlName="isReturnAcceptable">Return Acceptable</mat-checkbox>
        <mat-checkbox formControlName="isAvailableOnRent">Available On Rent</mat-checkbox>

        <div class="flex justify-end mt-4">
          <button mat-button matStepperNext>Next</button>
        </div>
      </form>
    </mat-step>

    <!-- Step 2: Images -->
    <mat-step [stepControl]="images">
      <ng-template matStepLabel>Images</ng-template>

      <div class="mb-3">
        <label class="block mb-2">Upload images (select multiple)</label>
        <input type="file" multiple (change)="onFilesSelected($event)" />
      </div>

      <div class="mb-3">
        <mat-form-field appearance="fill" class="w-full">
          <mat-label>Add image URL</mat-label>
          <input matInput placeholder="https://..." #imageUrlInput />
          <button mat-icon-button matSuffix aria-label="Add URL" (click)="addImageUrl(imageUrlInput.value); imageUrlInput.value=''">
            <mat-icon>add</mat-icon>
          </button>
        </mat-form-field>
      </div>

      <div class="grid grid-cols-3 gap-2">
        <div *ngFor="let img of images.controls; let i = index" class="p-2 border rounded">
          <img *ngIf="img.value.preview" [src]="img.value.preview" class="w-full h-32 object-cover mb-2" />
          <div class="truncate text-sm mb-2">{{ img.value.url || img.value.fileName }}</div>
          <div class="flex justify-between">
            <button mat-mini-button color="warn" (click)="removeImage(i)">Remove</button>
          </div>
        </div>
      </div>

      <div class="flex justify-end mt-4">
        <button mat-button matStepperPrevious>Back</button>
        <button mat-button matStepperNext>Add Sizes</button>
      </div>
    </mat-step>

    <!-- Step 3: Sizes & Quantity -->
    <mat-step [stepControl]="sizes">
      <ng-template matStepLabel>Sizes & Quantity</ng-template>

      <div formArrayName="sizes">
        <div *ngFor="let sizeCtrl of sizes.controls; let i = index" [formGroupName]="i" class="mb-3 p-3 border rounded">
          <mat-form-field appearance="fill" class="w-1/2 mr-2">
            <mat-label>Size</mat-label>
            <input matInput formControlName="size" />
          </mat-form-field>

          <mat-form-field appearance="fill" class="w-1/2">
            <mat-label>Quantity</mat-label>
            <input matInput type="number" formControlName="quantity" />
          </mat-form-field>

          <div class="mt-2">
            <button mat-mini-button color="warn" (click)="removeSize(i)">Remove</button>
          </div>
        </div>
      </div>

      <div class="mb-4">
        <button mat-stroked-button (click)="addSize()"><mat-icon>add</mat-icon> Add Size</button>
      </div>

      <div class="flex justify-end mt-4">
        <button mat-button matStepperPrevious>Back</button>
        <button mat-button (click)="finishAndSubmit()" color="primary">{{ isEdit ? 'Update' : 'Add' }}</button>
      </div>
    </mat-step>
  </mat-horizontal-stepper>
</form>

<mat-dialog-actions align="end" class="mt-4">
  <button mat-button (click)="onCancel()">Cancel</button>
</mat-dialog-actions>